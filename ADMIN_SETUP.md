# 管理画面セットアップガイド

## 🔒 管理画面の保護機能

管理画面 (`/admin`) は以下の2つの方法で保護されています：

1. **パスワード認証**: 環境変数で設定したパスワードが必要
2. **IPアドレス制限**: 指定したIPアドレスからのみアクセス可能（オプション）

---

## 📝 環境変数の設定

### ローカル開発環境

`.env.local` に以下を追加：

```bash
# 管理画面のパスワード（必須）
ADMIN_PASSWORD=your_strong_password_here

# 許可するIPアドレス（オプション、カンマ区切り）
# 空の場合は全てのIPからアクセス可能
ADMIN_ALLOWED_IPS=123.456.789.012,234.567.890.123
```

### Vercel本番環境

Vercelダッシュボードで環境変数を設定：

1. [Vercel Dashboard](https://vercel.com) にアクセス
2. プロジェクトを選択
3. **Settings** > **Environment Variables**
4. 以下の環境変数を追加：

| 変数名 | 値 | 説明 |
|--------|-----|------|
| `ADMIN_PASSWORD` | 強力なパスワード | 管理画面へのログインパスワード |
| `ADMIN_ALLOWED_IPS` | `123.456.789.012,234.567.890.123` | 許可するIPアドレス（カンマ区切り） |

**重要**: 設定後、再デプロイが必要です。

---

## 🌐 管理画面へのアクセス

### アクセスURL

```
https://your-domain.vercel.app/admin
```

### ログイン手順

1. `/admin` にアクセス
2. 自動的に `/admin/login` にリダイレクト
3. 設定したパスワードを入力
4. ログイン成功後、ダッシュボードが表示されます

### セッション

- ログイン後、**7日間**有効なセッションが作成されます
- ブラウザを閉じても、7日以内であれば再ログイン不要

---

## 🔍 自分のIPアドレスを確認する方法

IPアドレス制限を使用する場合、以下の方法で確認：

### 方法1: ウェブサイトで確認

- https://www.whatismyip.com/
- https://ipinfo.io/

### 方法2: コマンドで確認

```bash
# Mac/Linux
curl ifconfig.me

# Windows PowerShell
(Invoke-WebRequest -Uri "https://api.ipify.org").Content
```

---

## 🛡️ セキュリティのベストプラクティス

### パスワード

- **最低12文字以上**を推奨
- 大文字・小文字・数字・記号を混在させる
- 例: `MyS3cur3P@ssw0rd!2024`

### IPアドレス制限

- 固定IPを持っている場合は必ず設定
- 複数のIPを許可する場合はカンマで区切る
  ```
  ADMIN_ALLOWED_IPS=123.456.789.012,234.567.890.123,345.678.901.234
  ```
- IPが変わる環境の場合は空欄にしてパスワード認証のみ使用

### 定期的な更新

- パスワードを定期的に変更（推奨: 3ヶ月ごと）
- アクセスログを確認

---

## 🚨 トラブルシューティング

### ログインできない

1. パスワードが正しいか確認
2. Vercelの環境変数が設定されているか確認
3. 最新のデプロイが完了しているか確認

### IPアドレスでブロックされる

1. 現在のIPアドレスを確認
2. Vercelの環境変数 `ADMIN_ALLOWED_IPS` を更新
3. 再デプロイ

### セッションが切れる

- 7日経過後は再ログインが必要です
- ブラウザのCookieをクリアした場合も再ログインが必要

---

## 📊 管理画面の機能

- **本日の実績**: 診断数、課金数、売上、CVR
- **累計実績**: 総診断数、総課金数、総売上、平均CVR
- **日別グラフ**: 過去30日の診断数と売上の推移
- **タイプ別分布**: 6つの恋愛タイプの分布

---

## 🔐 ログアウト

現在、ログアウト機能は実装されていません。
セッションをクリアするには：

1. ブラウザのCookieをクリア
2. または、開発者ツールで `admin_session` Cookieを削除

---

## 💡 Tips

- パスワードは`.env.local`に記載するため、Gitにコミットしないでください
- 本番環境では必ずVercelの環境変数を使用してください
- IPアドレス制限を使わない場合は `ADMIN_ALLOWED_IPS` を空にしてください
